<!DOCTYPE html>
<html>
<head>
    <title>Live Accelerometer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h1>Live Accelerometer</h1>

<canvas id="accChart"></canvas>

<script>
document.addEventListener("DOMContentLoaded", function() {

    const canvas = document.getElementById("accChart");
    if (!canvas) return;

    const ctx = canvas.getContext("2d");

    const accChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: [],
            datasets: [
                { label: "X", data: [], borderColor: "red", fill: false },
                { label: "Y", data: [], borderColor: "blue", fill: false },
                { label: "Z", data: [], borderColor: "green", fill: false }
            ]
        },
        options: {
            animation: false,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    let lastId = 0;

    function fetchData() {
        fetch(`/api/sensor/?last_id=${lastId}`)
            .then(response => response.json())
            .then(data => {

                data.forEach(item => {
                    accChart.data.labels.push(item.id);
                    accChart.data.datasets[0].data.push(item.x);
                    accChart.data.datasets[1].data.push(item.y);
                    accChart.data.datasets[2].data.push(item.z);
                    lastId = item.id;
                });

                if (accChart.data.labels.length > 50) {
                    accChart.data.labels.shift();
                    accChart.data.datasets.forEach(d => d.data.shift());
                }

                accChart.update();
            });
    }

    setInterval(fetchData, 1000);
});
</script>

</body>
</html>